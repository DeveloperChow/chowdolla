<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0b0f14">
<title>ChowDolla</title>

<link rel="manifest" href="./manifest.json">
<link rel="apple-touch-icon" href="./icon-192.png">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
html,body{margin:0;height:100%;background:#0b0f14;color:#e9eef7;font-family:-apple-system,system-ui;overflow:hidden}
*{-webkit-tap-highlight-color:transparent}
.hidden{display:none}
.safe{padding:14px 14px 110px;height:100%;overflow:auto}

.card{background:rgba(20,26,40,.92);border:1px solid rgba(255,255,255,.12);border-radius:22px;padding:16px;margin-bottom:14px}
input,button{width:100%;padding:12px;border-radius:16px;border:none;font-size:16px}
input{background:#0c1220;color:white;border:1px solid rgba(255,255,255,.15)}
button{background:#4f7cff;color:white;font-weight:900}
.btnGhost{background:rgba(255,255,255,.08)}
.small{font-size:12px;opacity:.6}
.big{font-size:28px;font-weight:1000}

.nav{position:fixed;bottom:0;left:0;right:0;padding:12px;background:rgba(5,7,13,.95)}
.navRow{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.navBtn{padding:10px;border-radius:14px;background:rgba(255,255,255,.08);text-align:center;font-size:12px}
.navBtn.active{background:#4f7cff}

.asset{padding:12px;border-radius:18px;border:1px solid rgba(255,255,255,.12);margin-top:10px}
.plus{float:right;font-size:20px;font-weight:1000}
</style>
</head>

<body>
<div class="safe">

<div class="card" id="auth">
  <div class="big">CHOWDOLLA</div>
  <div class="small">fake money game</div><br>
  <input id="user" placeholder="username">
  <input id="pass" type="password" placeholder="password"><br><br>
  <button onclick="login()">login</button>
  <button class="btnGhost" onclick="signup()">signup</button>
</div>

<div id="app" class="hidden">

<div id="home" class="card">
  <span class="plus" onclick="adminAdd()">+</span>
  <div class="big">£<span id="bal">0.00</span></div>
  <div class="small">balance</div><br>

  <button onclick="tap()">TAP +£0.05</button><br><br>

  <button onclick="quick()">£5 bonus</button>
  <div class="small" id="quickT">READY</div>
</div>

<div id="assets" class="card hidden">
  <div class="big">Assets</div>
  <div class="small">Car</div>
  <div id="carSlot" class="asset small">none</div>
  <div class="small" style="margin-top:10px">Home</div>
  <div id="homeSlot" class="asset small">none</div>
</div>

<div id="jobs" class="card hidden">
  <div class="big">Jobs</div>
  <div id="jobList"></div>
</div>

<div id="market" class="card hidden">
  <span class="plus" onclick="adminAddMarket()">+</span>
  <div class="big">Marketplace</div>
  <div id="marketList"></div>
</div>

<div id="me" class="card hidden">
  <div class="big" id="meName"></div>
  <button onclick="logout()">logout</button>
</div>

</div>
</div>

<div class="nav hidden" id="nav">
  <div class="navRow">
    <div class="navBtn active" onclick="go('home')">HOME</div>
    <div class="navBtn" onclick="go('assets')">ASSETS</div>
    <div class="navBtn" onclick="go('jobs')">JOBS</div>
    <div class="navBtn" onclick="go('market')">MARKET</div>
    <div class="navBtn" onclick="go('me')">ME</div>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyC7-SKTrNG5kMs5uoem-sun3-wUCtAYQMw",
  authDomain:"chowdolla.firebaseapp.com",
  projectId:"chowdolla"
});
const db=firebase.firestore();

let me=null, doc=null, jobTimer=null;

const JOBS=[
  {id:"cleaner",name:"Cleaner",pay:6.5},
  {id:"driver",name:"Driver",pay:7},
  {id:"chef",name:"Chef",pay:8}
];

const MARKET_DEFAULT=[
  {id:"golf",type:"car",name:"VW Golf",price:2000},
  {id:"bmw",type:"car",name:"BMW 3 Series",price:5000},
  {id:"flat",type:"home",name:"Basic Flat",price:8000}
];

async function signup(){
  const u=user.value.toLowerCase(),p=pass.value;
  if(!u||!p)return;
  const ref=db.collection("users").doc(u);
  if((await ref.get()).exists)return alert("taken");
  await ref.set({
    pw:p,balance:0,
    car:null,home:null,
    job:null,lastQuick:0,
    isAdmin:u==="chowibz"
  });
  me=u; start();
}

async function login(){
  const u=user.value.toLowerCase(),p=pass.value;
  const s=await db.collection("users").doc(u).get();
  if(!s.exists||s.data().pw!==p)return alert("wrong");
  me=u; start();
}

function start(){
  auth.classList.add("hidden");
  app.classList.remove("hidden");
  nav.classList.remove("hidden");

  db.collection("users").doc(me).onSnapshot(s=>{
    doc=s.data();
    bal.textContent=doc.balance.toFixed(2);
    meName.textContent="@"+me;
    render();
  });
}

function tap(){update(0.05)}

function quick(){
  const left=30*60*1000-(Date.now()-doc.lastQuick);
  if(left>0)return;
  update(5);
  db.collection("users").doc(me).update({lastQuick:Date.now()});
}

function update(v){
  if(doc.balance+v<0)return;
  db.collection("users").doc(me).update({balance:doc.balance+v});
}

function render(){
  carSlot.textContent=doc.car||"none";
  homeSlot.textContent=doc.home||"none";

  jobList.innerHTML=JOBS.map(j=>
    `<div class="asset" onclick="setJob('${j.id}')">${j.name} £${j.pay}/h</div>`
  ).join("");

  marketList.innerHTML=MARKET_DEFAULT.map(i=>
    `<div class="asset" onclick="buy('${i.id}')">${i.name} £${i.price}</div>`
  ).join("");
}

function setJob(id){
  const j=JOBS.find(x=>x.id===id);
  if(!j)return;
  clearInterval(jobTimer);
  jobTimer=setInterval(()=>update(j.pay/4),15*60*1000);
  alert("job set");
}

function buy(id){
  const i=MARKET_DEFAULT.find(x=>x.id===id);
  if(!i||doc.balance<i.price)return alert("not enough");
  update(-i.price);
  if(i.type==="car") db.collection("users").doc(me).update({car:i.name});
  if(i.type==="home") db.collection("users").doc(me).update({home:i.name});
}

function adminAddMarket(){
  if(!doc.isAdmin)return;
  alert("admin add UI next");
}

function adminAdd(){
  if(!doc.isAdmin)return;
  alert("admin menu next");
}

function go(p){
  ["home","assets","jobs","market","me"].forEach(x=>{
    document.getElementById(x).classList.toggle("hidden",x!==p);
  });
}

function logout(){location.reload()}

setInterval(()=>{
  if(!doc)return;
  const left=30*60*1000-(Date.now()-doc.lastQuick);
  quickT.textContent=left<=0?"READY":Math.ceil(left/60000)+" min";
},1000);
</script>
</body>
</html>
