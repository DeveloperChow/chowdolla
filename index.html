<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>ChowDolla</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;background:#000;color:#eaeaea;font-family:-apple-system,system-ui}
.hidden{display:none}
.safe{padding:16px 16px 120px}
.card{background:#0f1115;border-radius:22px;padding:16px;margin-bottom:14px}
.big{font-size:30px;font-weight:1000}
.mid{font-size:18px;font-weight:700}
.small{font-size:12px;opacity:.55}
button{width:100%;padding:14px;border-radius:16px;border:none;background:#1db954;color:#000;font-weight:900}
.btnGhost{background:#1b1f29;color:#fff}
.row{display:flex;gap:10px}
.plus{float:right;font-size:22px;font-weight:1000;cursor:pointer}
.nav{position:fixed;bottom:0;left:0;right:0;background:#000;padding:10px}
.navRow{display:grid;grid-template-columns:repeat(6,1fr);gap:6px}
.navBtn{background:#141824;padding:10px;border-radius:14px;font-size:11px;text-align:center}
.navBtn.active{background:#1db954;color:#000}
.asset{background:#141824;border-radius:16px;padding:12px;margin-top:8px}
.bonusGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
</style>
</head>

<body>
<div class="safe">

<!-- AUTH -->
<div id="auth" class="card">
  <div class="big">ChowDolla</div>
  <div class="small">fake money game</div><br>
  <input id="u" placeholder="username"><br><br>
  <input id="p" type="password" placeholder="password"><br><br>
  <button onclick="login()">Login</button>
  <button class="btnGhost" onclick="signup()">Signup</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

<!-- HOME -->
<div id="home" class="card">
  <div class="small">Balance</div>
  <div class="big">£<span id="bal">0.00</span></div><br>

  <button onclick="tap()">TAP +£0.05</button><br><br>

  <div class="mid">Bonuses</div><br>
  <div class="bonusGrid">
    <button onclick="bonus(2,600000)">+£2</button>
    <button onclick="bonus(5,1800000)">+£5</button>
    <button onclick="bonus(10,3600000)">+£10</button>
    <button onclick="bonus(20,7200000)">+£20</button>
    <button onclick="bonus(50,21600000)">+£50</button>
    <button onclick="bonus(100,43200000)">+£100</button>
  </div>
</div>

<!-- TRANSFER -->
<div id="send" class="card hidden">
  <div class="mid">Transfer</div><br>
  <input id="toUser" placeholder="to username"><br><br>
  <input id="amt" type="number" placeholder="amount"><br><br>
  <button onclick="send()">Send</button>
</div>

<!-- CHAT -->
<div id="chat" class="card hidden">
  <div class="mid">Messages</div><br>
  <input id="chatTo" placeholder="to username"><br><br>
  <input id="chatMsg" placeholder="message"><br><br>
  <button onclick="message()">Send</button>
</div>

<!-- JOBS -->
<div id="jobs" class="card hidden">
  <div class="mid">Jobs</div>
  <div id="jobList"></div>
</div>

<!-- ASSETS -->
<div id="assets" class="card hidden">
  <div class="plus" onclick="adminAdd()">+</div>
  <div class="mid">Assets</div>
  <div id="assetList"></div>
</div>

<!-- ME -->
<div id="me" class="card hidden">
  <div class="big">@<span id="meName"></span></div><br>
  <button onclick="logout()">Logout</button><br><br>
  <button id="adminBtn" class="btnGhost hidden" onclick="adminMoney()">ADMIN +£1000</button>
</div>

</div>
</div>

<div class="nav hidden" id="nav">
  <div class="navRow">
    <div class="navBtn active" onclick="go('home')">Home</div>
    <div class="navBtn" onclick="go('send')">Pay</div>
    <div class="navBtn" onclick="go('chat')">Chat</div>
    <div class="navBtn" onclick="go('jobs')">Jobs</div>
    <div class="navBtn" onclick="go('assets')">Assets</div>
    <div class="navBtn" onclick="go('me')">Me</div>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyC7-SKTrNG5kMs5uoem-sun3-wUCtAYQMw",
  authDomain:"chowdolla.firebaseapp.com",
  projectId:"chowdolla"
});
const db=firebase.firestore();

let me=null,doc=null;

const JOBS=[
  ...Array.from({length:35},(_,i)=>({
    name:"Job "+(i+1),
    req:[50,100,180,203,280,340,360][i%7]+i*15,
    pay:6.5+(i%6),
    hours:6+(i%3)
  }))
];

function signup(){
  const u=uEl.value.toLowerCase(),p=pEl.value;
  if(!u||!p)return;
  db.collection("users").doc(u).get().then(s=>{
    if(s.exists)return alert("taken");
    db.collection("users").doc(u).set({
      pw:p,balance:0,taps:0,isAdmin:u==="chowibz",assets:[],lastBonus:{}
    });
    me=u; start();
  });
}
function login(){
  const u=uEl.value.toLowerCase(),p=pEl.value;
  db.collection("users").doc(u).get().then(s=>{
    if(!s.exists||s.data().pw!==p)return alert("wrong");
    me=u; start();
  });
}
function start(){
  auth.classList.add("hidden");
  app.classList.remove("hidden");
  nav.classList.remove("hidden");
  db.collection("users").doc(me).onSnapshot(s=>{
    doc=s.data();
    bal.textContent=doc.balance.toFixed(2);
    meName.textContent=me;
    adminBtn.classList.toggle("hidden",!doc.isAdmin);
    renderJobs(); renderAssets();
  });
}
function tap(){update(0.05);db.collection("users").doc(me).update({taps:(doc.taps||0)+1})}
function bonus(v,cd){
  const last=doc.lastBonus[v]||0;
  if(Date.now()-last<cd)return alert("cooldown");
  update(v);
  doc.lastBonus[v]=Date.now();
  db.collection("users").doc(me).update({lastBonus:doc.lastBonus});
}
function send(){
  const t=toUser.value.toLowerCase(),a=+amt.value;
  if(!t||a<=0||doc.balance<a)return;
  const f=db.collection("users").doc(me);
  const to=db.collection("users").doc(t);
  db.runTransaction(tx=>tx.get(to).then(s=>{
    if(!s.exists)throw"no user";
    tx.update(f,{balance:doc.balance-a});
    tx.update(to,{balance:(s.data().balance||0)+a});
  }));
}
function message(){
  alert("message sent (stored)");
}
function renderJobs(){
  jobList.innerHTML="";
  JOBS.forEach(j=>{
    jobList.innerHTML+=`<div class="asset">${j.name} • ${j.req} taps • £${j.pay}/h</div>`;
  });
}
function renderAssets(){
  assetList.innerHTML=doc.assets.length?doc.assets.map(a=>`<div class="asset">${a}</div>`).join(""):"<div class='small'>none</div>";
}
function adminMoney(){
  update(1000);
}
function adminAdd(){
  if(!doc.isAdmin)return;
  const a=prompt("add asset");
  if(a)db.collection("users").doc(me).update({assets:[...doc.assets,a]});
}
function update(v){db.collection("users").doc(me).update({balance:doc.balance+v})}
function go(p){
  ["home","send","chat","jobs","assets","me"].forEach(x=>document.getElementById(x).classList.toggle("hidden",x!==p));
}
function logout(){location.reload()}
const uEl=document.getElementById("u"),pEl=document.getElementById("p");
</script>
</body>
</html>
