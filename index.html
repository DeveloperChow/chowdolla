<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>ChowDolla</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
html,body{margin:0;height:100%;background:#05070b;color:#e9eeff;font-family:-apple-system,system-ui;overflow:hidden}
*{-webkit-tap-highlight-color:transparent}
.hidden{display:none}

:root{--card:#0b1426;--accent:#3b82ff;--muted:#7f8db3}

.page{position:absolute;inset:0;padding:14px 14px 90px}
.scroll{height:100%;overflow:auto}

.card{background:linear-gradient(180deg,#0e1b33,#091326);border-radius:22px;padding:14px;margin-bottom:12px;border:1px solid rgba(255,255,255,.08)}
h1{margin:0;font-size:18px}
.small{font-size:12px;color:var(--muted)}

.btn{background:var(--accent);border:none;color:white;padding:12px;border-radius:16px;font-weight:800;width:100%}
.btn.dark{background:#132242}
.btn.red{background:#b91c1c}
.btn:active{transform:scale(.97)}

.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}

.nav{position:fixed;bottom:0;left:0;right:0;background:#04060a;padding:10px}
.navRow{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.navBtn{background:#0d1626;border-radius:14px;padding:10px 0;text-align:center;font-size:12px;color:#9aa3b2}
.navBtn.active{background:var(--accent);color:white}

.tapBtn{width:240px;height:80px;margin:12px auto;border-radius:28px;background:linear-gradient(180deg,#ff4d4d,#a10000);box-shadow:0 18px 40px rgba(0,0,0,.6)}

.full{position:fixed;inset:0;background:#05070b;z-index:20;padding:14px;display:none}
.full.active{display:block}

.chatRow{padding:12px;border-bottom:1px solid rgba(255,255,255,.06)}
.chatScreen{display:flex;flex-direction:column;height:100%}
.chatLog{flex:1;overflow:auto;padding-bottom:10px}
.msg{margin-bottom:6px}
.me{color:#3b82ff}
.them{color:#7aff9b}
.chatInput{display:flex;gap:8px}
input{flex:1;padding:12px;border-radius:16px;border:none;background:#0d1626;color:white}
</style>
</head>

<body>

<!-- AUTH -->
<div class="page" id="auth">
<div class="card">
<h1>ChowDolla</h1>
<input id="email" placeholder="email">
<input id="pass" type="password" placeholder="password">
<button class="btn" onclick="login()">Login / Signup</button>
</div>
</div>

<!-- HOME -->
<div class="page hidden" id="home">
<div class="scroll">
<div class="card">
<div class="small">Balance</div>
<h1>Â£<span id="bal">0.00</span></h1>
<div class="small">Taps: <span id="taps">0</span></div>
<button class="tapBtn" onclick="tap()"></button>
<div class="small" style="text-align:center">Tap = Â£0.05</div>
</div>

<div class="card">
<h1>Bonuses</h1>
<div class="grid">
<button class="btn" onclick="bonus(5,1800)">Â£5 / 30m</button>
<button class="btn" onclick="bonus(10,3600)">Â£10 / 1h</button>
<button class="btn" onclick="bonus(20,7200)">Â£20 / 2h</button>
<button class="btn" onclick="bonus(50,21600)">Â£50 / 6h</button>
</div>
</div>
</div>
</div>

<!-- CHAT -->
<div class="page hidden" id="chat">
<div class="scroll">
<div class="card">
<h1>Chats</h1>
<div id="chatList"></div>
</div>
</div>
</div>

<div class="full" id="chatScreen">
<div class="chatScreen">
<h1 id="chatWith"></h1>
<div class="chatLog" id="chatLog"></div>
<div class="chatInput">
<input id="msg">
<button class="btn" onclick="sendMsg()">Send</button>
</div>
<button class="btn dark" onclick="closeChat()">Back</button>
</div>
</div>

<!-- ME -->
<div class="page hidden" id="me">
<div class="scroll">
<div class="card">
<h1 id="meName"></h1>
<button class="btn dark" onclick="adminAdd()">Admin add money</button>
<button class="btn red" onclick="logout()">Logout</button>
</div>
</div>
</div>

<!-- NAV -->
<div class="nav hidden" id="nav">
<div class="navRow">
<div class="navBtn active" onclick="go('home')">Home</div>
<div class="navBtn" onclick="go('chat')">Chat</div>
<div class="navBtn" onclick="go('me')">Me</div>
</div>
</div>

<script>
// ðŸ”¥ FIREBASE CONFIG (YOURS)
firebase.initializeApp({
  apiKey:"AIzaSyC7-SKTrNG5kMs5uoem-sun3-wUCtAYQMw",
  authDomain:"chowdolla.firebaseapp.com",
  projectId:"chowdolla"
})
const auth=firebase.auth()
const db=firebase.firestore()

let me=null, userDoc=null

auth.onAuthStateChanged(async u=>{
  if(!u) return
  me=u
  authPage(false)
  const ref=db.collection("users").doc(u.uid)
  const snap=await ref.get()
  if(!snap.exists){
    await ref.set({balance:0,taps:0,isAdmin:u.email.startsWith("chowibz"),lastInterest:Date.now()})
  }
  ref.onSnapshot(s=>{
    userDoc=s.data()
    render()
  })
})

// AUTH
function login(){
  auth.signInWithEmailAndPassword(email.value,pass.value)
  .catch(()=>auth.createUserWithEmailAndPassword(email.value,pass.value))
}
function logout(){auth.signOut();location.reload()}

// UI
function authPage(ok){
  auth.classList.toggle("hidden",ok)
  home.classList.toggle("hidden",!ok)
  nav.classList.toggle("hidden",!ok)
}
function go(p){
  document.querySelectorAll(".page").forEach(x=>x.classList.add("hidden"))
  document.getElementById(p).classList.remove("hidden")
}

// ECONOMY
function tap(){
  db.collection("users").doc(me.uid).update({
    taps:firebase.firestore.FieldValue.increment(1),
    balance:firebase.firestore.FieldValue.increment(0.05)
  })
}
function bonus(v,cd){
  db.collection("users").doc(me.uid).update({
    balance:firebase.firestore.FieldValue.increment(v)
  })
}

// CHAT
function openChat(uid){
  chatWith.textContent=uid
  chatScreen.classList.add("active")
}
function closeChat(){chatScreen.classList.remove("active")}
function sendMsg(){
  db.collection("messages").add({
    from:me.uid,to:chatWith.textContent,text:msg.value,ts:Date.now()
  })
  msg.value=""
}

// ADMIN
function adminAdd(){
  if(!userDoc.isAdmin) return
  let v=+prompt("Amount")
  if(v) db.collection("users").doc(me.uid).update({balance:firebase.firestore.FieldValue.increment(v)})
}

function render(){
  bal.textContent=userDoc.balance.toFixed(2)
  taps.textContent=userDoc.taps
  meName.textContent=me.email
}
</script>
</body>
</html>
